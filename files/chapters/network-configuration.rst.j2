Appendix A - Network Configuration
==================================

.. list-table:: Firewall rules
   :widths: 1 1 1 1
   :header-rows: 1

   * - Src
     - Dst
     - Dst proto/port
     - Description
   * - Jumphost
     - | {{ servers.root_ca.name }}
       | {{ servers.issuing_ca.name }}
       | {{ servers.repository.name }}
       | Domain controllers
     - tcp/3389
     - RDP
   * - {{ servers.issuing_ca.name }}
     - Domain controller
     - tcp/135
     - RPC Endpoint Mapper
   * - {{ servers.issuing_ca.name }}
     - Domain controllers
     - tcp/1024-65535
     - RPC
   * - {{ servers.issuing_ca.name }}
     - Domain controllers
     - tcp/389 and udp/389
     - LDAP
   * - {{ servers.issuing_ca.name }}
     - Domain controllers
     - tcp/636
     - LDAP over TLS
   * - | {{ servers.issuing_ca.name }}
       | {{ servers.repository.name }}
     - DNS servers
     - tcp/53 and udp/53
     - DNS
   * - {{ servers.issuing_ca.name }}
     - Domain controllers
     - 88/tcp
     - Kerberos
   * - {{ servers.issuing_ca.name }}
     - DNS server
     - 88/udp
     - Kerberos
   * - All computers connected to the domain
     - {{ servers.issuing_ca.name }}
     - tcp/135
     - RPC Endpoint Mapper
   * - All computers connected to the domain
     - {{ servers.issuing_ca.name }} 
     - tcp/1024-65535
     - CertSrv requests over DCOM
   * - Internet
     - {{ servers.repository.name }}
     - http/80
     - Certificate validation

{% if network.dcom_port is defined %}
Firewall hardening
------------------

After a certificate request has been successfully processed by ``{{ servers.issuing_ca.name }}``, all subsequent certificate requests can be sent to port {{ network.dcom_port }}. This means that the firewall may be locked down to only allow incoming connections to that port.
{% endif %}